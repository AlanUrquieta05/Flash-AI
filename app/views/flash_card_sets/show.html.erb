<% content_for :head do %>
  <%= stylesheet_link_tag 'flash_card_study', media: 'all' %>
<% end %>

<div class="study-container">
  <!-- Header -->
  <div class="study-header">
    <div class="logo">Flash-AI</div>
    <h1 class="set-title"><%= @flash_card_set.name %></h1>
    <a href="#" class="create-test-btn">
      Create Test
      <span class="arrow">â–¶</span>
    </a>
  </div>
  
  <!-- Back to home link -->
  <a href="<%= flash_card_sets_path %>" class="back-link">Back to home</a>
  
  <!-- Flash Card View -->
  <div class="flashcard-container">
    <div class="nav-button prev-button">
      <span>&#10094;</span>
    </div>
    
    <div class="flashcard">
      <div id="card-content" class="card-content">
        <!-- Card content will be inserted here by JavaScript -->
      </div>
    </div>
    
    <div class="nav-button next-button">
      <span>&#10095;</span>
    </div>
  </div>
  
  <!-- Flip Button -->
  <div class="flip-button-container">
    <div class="flip-button">&#8635;</div>
    <div class="flip-button" style="transform: rotate(-90deg)">&#8635;</div>
  </div>
  
  <!-- Table View -->
  <div class="table-container">
    <div class="table-header">
      <div class="front-column">Front</div>
      <div class="back-column">Back</div>
    </div>
    
    <div class="horizontal-divider"></div>
    
    <!-- Actual flash cards from the database -->
    <% if @flash_card_set.cards.present? %>
      <% @flash_card_set.cards.each do |card| %>
        <div class="table-row">
          <div class="table-cell front-column">
            <%= card[:front] %>
          </div>
          <div class="table-cell">
            <%= card[:back] %>
          </div>
        </div>
        <div class="horizontal-divider"></div>
      <% end %>
    <% else %>
      <div class="table-row">
        <div class="table-cell front-column" colspan="2">
          No flashcards found for this set
        </div>
      </div>
      <div class="horizontal-divider"></div>
    <% end %>
  </div>
</div>

<script>
  // Wrap in an IIFE to avoid global scope pollution
  (function() {
    // Get cards data from Rails
    const flashCards = <%= raw @flash_card_set.cards.to_json %>;
    
    // Initialize variables
    let currentCardIndex = 0;
    let isShowingFront = true;
    
    // Function to update card display
    function updateCardDisplay() {
      const cardContent = document.getElementById('card-content');
      if (!cardContent || flashCards.length === 0) {
        cardContent.innerHTML = "No flashcards found for this set";
        return;
      }
      
      if (isShowingFront) {
        cardContent.innerHTML = `<strong>Front</strong><br><br>${flashCards[currentCardIndex].front}`;
      } else {
        cardContent.innerHTML = `<strong>Back</strong><br><br>${flashCards[currentCardIndex].back}`;
      }
    }
    
    // Function to handle flip button clicks
    function handleFlipClick() {
      if (flashCards.length === 0) return;
      isShowingFront = !isShowingFront;
      updateCardDisplay();
    }
    
    // Function to handle previous button clicks
    function handlePrevClick() {
      if (flashCards.length === 0) return;
      currentCardIndex = (currentCardIndex - 1 + flashCards.length) % flashCards.length;
      isShowingFront = true;
      updateCardDisplay();
    }
    
    // Function to handle next button clicks
    function handleNextClick() {
      if (flashCards.length === 0) return;
      currentCardIndex = (currentCardIndex + 1) % flashCards.length;
      isShowingFront = true;
      updateCardDisplay();
    }
    
    // Add event listeners to buttons
    document.querySelectorAll('.flip-button').forEach(button => {
      button.addEventListener('click', handleFlipClick);
    });
    
    const prevButton = document.querySelector('.prev-button');
    if (prevButton) {
      prevButton.addEventListener('click', handlePrevClick);
    }
    
    const nextButton = document.querySelector('.next-button');
    if (nextButton) {
      nextButton.addEventListener('click', handleNextClick);
    }
    
    // Initialize the display
    updateCardDisplay();
  })();
</script>
